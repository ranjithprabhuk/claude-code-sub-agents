# Brinqa Vulnerability Manager - Examples

This document provides detailed examples of how the agent handles different types of vulnerabilities.

## Example 1: Simple Patch Upgrade (Fix Immediately)

### Input
```
Description
Improper Neutralization of Input During Web Page Generation (XSS or 'Cross-site Scripting')
vulnerability in Bootstrap allows Cross-site Scripting (XSS). This issue affects bootstrap version 3.4.1.

SkiShield Version: 1.4.8.6

Meta Data
{
  "library_name": "bootstrap",
  "library_version": "3.4.1",
  "cwe": "CWE-79",
  "cve": "CVE-2025-1647",
  "file_path": ["app/client/package.json"],
  "exploitable_path": "",
  "relation": null
}

Recommendation
Upgrade to bootstrap-4.3.1

Reference URLs
https://github.com/advisories/GHSA-q58r-hwc8-rm9j
```

### Agent Analysis
1. Searches for Bootstrap in codebase
2. Finds it's used in basic UI components
3. Checks if upgrade path from 3.4.1 to 4.3.1 has breaking changes
4. Discovers this is a MAJOR version change (3 → 4)
5. Determines extensive testing is required

### Agent Decision
**Risk Exception** - Major version upgrade requires significant testing

### Output
```markdown
# Risk Exception Request

Name: Risk Exception - CVE-2025-1647 in Bootstrap 3.4.1

Description of the finding:
Cross-site Scripting (XSS) vulnerability (CVE-2025-1647, CWE-79) in Bootstrap 3.4.1.
The vulnerability exists in the data-template, data-content, and data-title properties
of tooltip and popover components, allowing attackers to inject malicious scripts.

Affected files:
- app/client/package.json

Outcome or Impact of the finding:
An attacker could inject malicious JavaScript code through tooltip or popover attributes,
potentially leading to:
- Session hijacking
- Credential theft
- Unauthorized actions on behalf of users
- Defacement of the application

Justification for not fixing:
The recommended fix requires upgrading from Bootstrap 3.4.1 to 4.3.1, which is a major
version change with significant breaking changes:

1. Major CSS class name changes (col-xs-* → col-*, etc.)
2. JavaScript plugin API changes
3. Grid system modifications
4. Removed Glyphicons, requiring icon replacement
5. Changes to component markup structure

Impact Assessment:
- 23 HTML template files use Bootstrap components
- 15 JavaScript files interact with Bootstrap plugins
- Estimated effort: 2-3 weeks development + 1 week testing
- Risk of regression bugs in UI/UX

Risk Mitigation Plan:
Temporary measures while planning the upgrade:

1. Immediate (this week):
   - Audit all tooltip and popover usage
   - Implement input sanitization for user-supplied content in tooltips
   - Add Content Security Policy headers if not already present

2. Short-term (next sprint):
   - Code review of all data-* attribute usage
   - Implement automated XSS testing for affected components

3. Long-term (Q2 2026):
   - Plan Bootstrap 4 migration
   - Allocate 3 weeks for development and testing
   - Coordinate with QA team for comprehensive testing
   - Target completion: End of Q2 2026

Evidence:
Bootstrap 3.4.1 found in: app/client/package.json
```json
{
  "dependencies": {
    "bootstrap": "3.4.1"
  }
}
```

Files using Bootstrap tooltips/popovers:
- app/client/views/dashboard.html (3 instances)
- app/client/views/user-profile.html (2 instances)
- app/client/components/help-tooltips.js

Breaking changes documentation: https://getbootstrap.com/docs/4.0/migration/

Exception request date: 2026-01-20
```

---

## Example 2: Unused Dev Dependency (Vulnerability Not Actionable)

### Input
```
Description
Arbitrary file read vulnerability in webpack-dev-server allows reading files outside
of the web root through path traversal.

Meta Data
{
  "library_name": "webpack-dev-server",
  "library_version": "3.11.0",
  "cve": "CVE-2024-12345",
  "cwe": "CWE-22",
  "file_path": ["package.json"]
}

Recommendation
Upgrade to webpack-dev-server 4.0.0 or later
```

### Agent Analysis
1. Finds webpack-dev-server in package.json as devDependency
2. Checks if it's used in production
3. Confirms it's only used during local development
4. Verifies production builds don't include it
5. Reviews CI/CD process

### Agent Decision
**Vulnerability Not Actionable** - Only used in development, not in production

### Output
```markdown
# Vulnerability Not Actionable Request

Name: VNA - CVE-2024-12345 in webpack-dev-server 3.11.0

Description of the finding:
Path traversal vulnerability (CVE-2024-12345, CWE-22) in webpack-dev-server 3.11.0
allows arbitrary file read outside of the web root directory.

Justification:
This vulnerability is not actionable in our production environment for the following reasons:

1. **Development-Only Dependency**: webpack-dev-server is listed as a devDependency
   and is never deployed to production environments.

2. **Build Process Isolation**:
   - Production builds use webpack CLI directly, not webpack-dev-server
   - webpack-dev-server is excluded from production bundle
   - CI/CD pipeline uses production build configuration

3. **Limited Development Exposure**:
   - Only runs on developers' local machines
   - Binds to localhost only (127.0.0.1)
   - No external access to development servers
   - Development environments contain no production data or secrets

4. **Network Isolation**:
   - Development servers are not accessible from the internet
   - Corporate network policy prevents external access to developer workstations

Evidence:

package.json shows devDependency:
```json
{
  "devDependencies": {
    "webpack-dev-server": "3.11.0"
  }
}
```

Production build script (package.json):
```json
{
  "scripts": {
    "build": "webpack --mode production --config webpack.prod.js"
  }
}
```

webpack.prod.js configuration:
```javascript
module.exports = {
  mode: 'production',
  // No devServer configuration in production
  // Uses webpack CLI directly, not webpack-dev-server
}
```

CI/CD pipeline (Jenkinsfile):
```groovy
stage('Build') {
  steps {
    sh 'npm run build'  // Uses webpack CLI, not dev-server
  }
}
```

Docker production image does not include devDependencies:
```dockerfile
RUN npm ci --only=production
```

Analysis of production bundle:
- webpack-dev-server: NOT FOUND in production bundle
- Production bundle size: 2.3 MB (would be larger if dev-server included)

Conclusion:
The vulnerability exists only in the development toolchain and cannot be exploited
in any deployed environment. No production system is affected.
```

---

## Example 3: Low Severity with No Fix (Risk Acceptance)

### Input
```
Description
Information disclosure through verbose error messages in development mode of
Express framework. Error messages may reveal internal paths and stack traces.

Meta Data
{
  "library_name": "express",
  "library_version": "4.17.1",
  "cve": "CVE-2024-98765",
  "cwe": "CWE-209",
  "severity": "LOW",
  "file_path": ["server/package.json"]
}

Recommendation
No fix available. Configure error handling properly in production.
```

### Agent Analysis
1. Searches for Express error handling configuration
2. Checks if development mode is used in production
3. Reviews error handling middleware
4. Confirms production uses custom error handler
5. Assesses actual information disclosure risk

### Agent Decision
**Risk Acceptance** - Low severity, proper error handling already in place

### Output
```markdown
# Risk Acceptance Request

Name: Risk Acceptance - CVE-2024-98765 in Express 4.17.1

Description of the finding:
Information disclosure vulnerability (CVE-2024-98765, CWE-209) in Express 4.17.1.
In development mode, verbose error messages may expose internal file paths,
stack traces, and application structure through error responses.

Severity: LOW

Outcome or Impact of the finding:
In the worst case, if this vulnerability were exploited, an attacker could:
- Learn internal directory structure
- Identify dependencies and versions from stack traces
- Gain insights into application architecture

However, the actual impact is minimal because:
1. Our production environment does not run in development mode
2. Custom error handling is implemented that sanitizes all errors
3. Stack traces are logged server-side only, never sent to clients
4. Information disclosed would be limited and not directly exploitable

Required conditions for exploitation:
- NODE_ENV must be set to 'development' (it's set to 'production')
- Custom error handler would need to fail (has fallback mechanisms)
- Attacker would need to trigger errors (rate limiting prevents brute force)

Justification for not fixing:
Accepting this risk is appropriate because:

1. **Severity is LOW**: CVSS score indicates minimal risk

2. **No Fix Available**: Vendor has not released a patch. The CVE notes this is
   expected behavior in development mode, not a bug.

3. **Proper Configuration**: We have implemented all recommended mitigations:
   - NODE_ENV=production in all deployed environments
   - Custom error handling middleware
   - Error logging to secure log aggregation service
   - Generic error messages to clients

4. **Compensating Controls**: Multiple layers of protection exist

5. **Disproportionate Effort**: Fixing this would require:
   - Forking Express framework
   - Maintaining custom fork
   - Ongoing merge conflicts with upstream updates
   - Significant maintenance burden

6. **Planned Migration**: Application is scheduled for migration to Fastify
   framework in Q3 2026, which will eliminate this dependency.

Evidence:

Express version in server/package.json:
```json
{
  "dependencies": {
    "express": "4.17.1"
  }
}
```

Production error handling (server/middleware/errorHandler.js):
```javascript
module.exports = (err, req, res, next) => {
  // Log full error server-side
  logger.error({
    error: err.message,
    stack: err.stack,
    path: req.path
  });

  // Send sanitized error to client
  res.status(err.status || 500).json({
    error: 'An error occurred',
    requestId: req.id
  });
};
```

Environment configuration verification:
```bash
$ echo $NODE_ENV
production
```

Production deployment config (docker-compose.yml):
```yaml
environment:
  - NODE_ENV=production
  - EXPOSE_ERRORS=false
```

Testing results:
- Triggered intentional errors in staging environment
- Confirmed only generic messages returned to client
- Verified detailed errors logged server-side only
- Stack traces: NOT visible in HTTP responses

Compensating controls:
1. Custom error handler sanitizes all responses
2. Rate limiting prevents error enumeration
3. Web Application Firewall (WAF) monitors error patterns
4. Security logging and monitoring via Splunk
5. Regular security scans and penetration testing

CVE Assessment:
- CVSS Score: 3.7 (LOW)
- Exploitability: Requires specific misconfigurations
- Impact: Information disclosure only, no code execution

Conclusion:
The risk is minimal and properly mitigated through configuration and custom error
handling. Accepting this risk is more appropriate than the burden of maintaining
a forked framework. The dependency will be eliminated in the planned migration to
Fastify in Q3 2026.
```

---

## Example 4: Outdated Library with Multiple CVEs (Risk Exception)

### Input
```
Description
Multiple vulnerabilities in AngularJS 1.3.17:
- CVE-2019-10768: Prototype pollution vulnerability
- CVE-2020-7676: Cross-site Scripting in regex-based input replacement

Meta Data
{
  "library_name": "angularjs",
  "library_version": "1.3.17",
  "cve": ["CVE-2019-10768", "CVE-2020-7676"],
  "cwe": ["CWE-1321", "CWE-79"],
  "file_path": ["app/legacy/bower.json", "app/package.json"]
}

Recommendation
Upgrade to AngularJS 1.8.0 or migrate to Angular (2+)
```

### Agent Analysis
1. Discovers AngularJS used extensively in legacy application
2. Finds 47 files with AngularJS controllers and directives
3. Identifies significant breaking changes between versions
4. Recognizes this as a major refactoring effort
5. Notes application is using end-of-life framework

### Agent Decision
**Risk Exception** - Requires architectural migration, not a simple upgrade

### Output
```markdown
# Risk Exception Request

Name: Risk Exception - Multiple CVEs in AngularJS 1.3.17

Description of the finding:
Multiple critical vulnerabilities in AngularJS 1.3.17:

1. CVE-2019-10768 (CWE-1321): Prototype Pollution
   - The merge() function can be exploited to modify Object.prototype
   - Allows attackers to inject properties into all objects
   - Can lead to denial of service or property injection attacks

2. CVE-2020-7676 (CWE-79): Cross-Site Scripting
   - Regex-based input HTML replacement can turn sanitized code into unsanitized
   - Wrapping "<option>" tags changes parsing behavior
   - Can lead to XSS attacks through crafted input

Affected files:
- app/legacy/bower.json
- app/package.json
- 47 JavaScript files with AngularJS controllers/directives
- 62 HTML templates with AngularJS syntax

Outcome or Impact of the finding:
Successful exploitation could result in:

Prototype Pollution (CVE-2019-10768):
- Denial of Service by corrupting application state
- Bypass of security controls through property injection
- Potential remote code execution in specific scenarios

Cross-Site Scripting (CVE-2020-7676):
- Session hijacking through cookie theft
- Credential harvesting via fake login forms
- Malicious actions performed as the victim user
- Data exfiltration from the application

Combined, these vulnerabilities pose significant security risks to user data and
application integrity.

Justification for not fixing:
The recommended fixes are not feasible for immediate implementation:

**Option 1: Upgrade to AngularJS 1.8.0**
- Major breaking changes in the upgrade path
- Significant API changes between 1.3 and 1.8
- AngularJS 1.x reached End of Life in December 2021
- Investing in dead framework doesn't make business sense

**Option 2: Migrate to Angular (2+)**
- Complete rewrite required (AngularJS and Angular are different frameworks)
- Different language (JavaScript → TypeScript)
- Different architecture (MVC → Component-based)
- Different templating syntax
- Different routing mechanism

**Scope of Work:**
- 47 controller files requiring rewrite
- 62 HTML templates requiring conversion
- 12 custom services requiring refactoring
- 8 custom directives requiring reimplementation as components
- Estimated effort: 6-9 months with 2 developers
- Estimated cost: $250,000 - $400,000

**Business Impact:**
- Legacy application generates $2M annual revenue
- New platform is in development, scheduled for Q4 2026
- Legacy application will be decommissioned in Q4 2026
- Fixing these vulnerabilities requires 6-9 months
- Not economically justified for 9 months of remaining life

Risk Mitigation Plan:

**Immediate Actions (Week 1):**
1. Implement Content Security Policy (CSP) headers
   - Restrict inline script execution
   - Whitelist trusted script sources
   - Enable CSP reporting

2. Add input validation middleware
   - Sanitize all user inputs
   - Validate data types and formats
   - Reject suspicious patterns

3. Implement prototype freeze
   - Freeze Object.prototype in application initialization
   - Prevent runtime modifications

**Short-term (Month 1):**
1. Deploy Web Application Firewall (WAF) rules
   - Block known XSS patterns
   - Rate limit requests
   - Monitor for exploitation attempts

2. Enhanced monitoring and alerting
   - Log all authentication events
   - Alert on suspicious patterns
   - Monitor for prototype pollution indicators

3. Security assessment
   - Conduct focused penetration testing
   - Verify mitigation effectiveness
   - Document remaining residual risk

**Medium-term (Ongoing until decommission):**
1. Access restrictions
   - Limit legacy application to internal users only
   - Require VPN for access
   - Implement IP whitelisting

2. Accelerate new platform development
   - Priority deployment of replacement application
   - Parallel operation period minimized
   - Early migration of critical users

3. Decommission timeline
   - Code freeze on legacy application (no new features)
   - Target decommission: Q4 2026
   - Plan data migration strategy

**Long-term:**
- Complete migration to new platform: Q4 2026
- Decommission legacy AngularJS application: Q4 2026
- Vulnerabilities eliminated through replacement

Evidence:

AngularJS version in bower.json:
```json
{
  "dependencies": {
    "angular": "1.3.17"
  }
}
```

Codebase analysis:
```
$ find app/legacy -name "*.js" | xargs grep -l "angular.module" | wc -l
47

$ find app/legacy -name "*.html" | xargs grep -l "ng-" | wc -l
62
```

Example controller file (app/legacy/controllers/userController.js):
```javascript
angular.module('app').controller('UserController',
  function($scope, $http, UserService) {
    // 250 lines of AngularJS 1.x code
    // Uses deprecated patterns and APIs
  }
);
```

Migration effort estimate:
- Controllers to Components: 47 files × 4 hours = 188 hours
- Templates: 62 files × 2 hours = 124 hours
- Services refactoring: 12 files × 6 hours = 72 hours
- Directives to Components: 8 files × 8 hours = 64 hours
- Routing migration: 40 hours
- Testing: 120 hours
- Total: 608 hours (3.8 months with 1 developer)

Business case:
- Legacy app remaining life: 9 months
- Migration effort: 6-9 months
- Cost: $250k-400k
- New platform launch: Q4 2026
- Conclusion: Not economically justified

Mitigation implementation status:
- [X] CSP headers implemented
- [X] Input validation added
- [X] Object.prototype frozen
- [ ] WAF rules (in progress)
- [ ] Enhanced monitoring (planned)

Exception request date: 2026-01-20

Requested exception period: Until legacy application decommission (Q4 2026)
```

---

## Example 5: Quick Fix Applied (Fix Immediately)

### Input
```
Description
Regular expression Denial of Service (ReDoS) in validator.js library

Meta Data
{
  "library_name": "validator",
  "library_version": "13.5.2",
  "cve": "CVE-2024-11111",
  "cwe": "CWE-1333",
  "file_path": ["server/package.json"]
}

Recommendation
Upgrade to validator 13.7.0
```

### Agent Analysis
1. Finds validator.js used for input validation
2. Checks for breaking changes between 13.5.2 and 13.7.0
3. Confirms it's a minor version update
4. Reviews changelog - only bug fixes, no breaking changes
5. Verifies validator API usage is compatible

### Agent Decision
**Fix Immediately** - Minor version bump with no breaking changes

### Agent Action & Output
```
Analyzing CVE-2024-11111 in validator.js 13.5.2...

Found validator.js in: server/package.json

Checking version compatibility...
- Current: 13.5.2
- Recommended: 13.7.0
- Change type: Minor version (patch-level changes)

Reviewing changelog...
- 13.6.0: Fixed ReDoS in isEmail validator
- 13.7.0: Additional ReDoS fixes, performance improvements
- No breaking changes
- All existing API methods maintained

Searching for validator usage in codebase...
Found validator used in:
- server/middleware/validation.js (isEmail, isURL)
- server/routes/user.js (isAlphanumeric)
- server/utils/sanitize.js (escape, trim)

All methods are compatible with 13.7.0.

Applying fix...

Updated server/package.json:
- Before: "validator": "13.5.2"
- After: "validator": "13.7.0"

Fix applied successfully!

Next steps:
1. Run: npm install (to update package-lock.json)
2. Run: npm test (to verify all tests pass)
3. Test the following functionality:
   - Email validation on registration form
   - URL validation in profile settings
   - Input sanitization in all forms

4. Deploy to staging for validation
5. Monitor for any validation errors in logs

Summary:
✓ Fixed CVE-2024-11111 by upgrading validator from 13.5.2 to 13.7.0
✓ No breaking changes
✓ All existing code remains compatible
✓ ReDoS vulnerability eliminated
```

---

## Summary Decision Matrix

| Scenario | Fix Available | Impact | Severity | Decision |
|----------|---------------|---------|----------|----------|
| Patch version upgrade | Yes | Low | Any | **Fix Immediately** |
| Minor version upgrade (no breaking changes) | Yes | Low | Any | **Fix Immediately** |
| Major version upgrade | Yes | High | Any | **Risk Exception** |
| Significant code changes required | Yes | High | Any | **Risk Exception** |
| Dev dependency only | Yes/No | None | Any | **Vulnerability Not Actionable** |
| Unreachable code path | Yes/No | None | Any | **Vulnerability Not Actionable** |
| No fix available | No | Low | Low | **Risk Acceptance** |
| No fix + proper mitigations | No | Low | Medium | **Risk Acceptance** |
| No fix + EOL framework | No | High | High | **Risk Exception** |
